language: rust
sudo: required
dist: trusty
rust: nightly

matrix:
  include:
    - os: linux
      env: TARGETS=x86-linux
      before_install:
        - sudo apt-get install -y --no-install-recommends gcc-multilib libc6-dev
      install:
        - rustup target add i586-unknown-linux-gnu
        - rustup target add i686-unknown-linux-gnu
      script:
        - TARGET=i586-unknown-linux-gnu cargo test --verbose
        - TARGET=i686-unknown-linux-gnu cargo test --verbose
    - os: osx
      env: TARGET=x86_64-apple-darwin
      script: cargo test --verbose
    - os: linux
      env: TARGET=x86_64-unknown-linux-gnu
      script: cargo test --verbose
