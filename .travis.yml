language: rust
sudo: required
dist: trusty
rust: nightly

group: edge

matrix:
  include:
    - os: linux
      env:
        - TARGET=armv5te-unknown-linux-gnueabi
        - ARCH=arm
        - GCC_VARIANT=arm-linux-gnueabi
      before_install: LIBC_VARIANT=armel sh ci/install_qemu_and_gcc.sh
      install:
        - rustup target add arm-unknown-linux-gnueabi
#        - rustup target add armv5te-unknown-linux-gnueabi
      script:
        - qemu-img create -f qcow2 mainstone1.img 64M
        - qemu-img create -f qcow2 mainstone2.img 64M
        - export QEMU_ARGS="-append 'console=ttyS0' -machine mainstone
          -pflash mainstone1.img -pflash mainstone2.img"
        - export RUSTC_TARGET=arm-unknown-linux-gnueabi
        - sh ci/test_in_qemu.sh
